const{Engine:Engine,Render:Render,Runner:Runner,Body:Body,Composite:Composite,Composites:Composites,Constraint:Constraint,Events:Events,Bodies:Bodies,Vector:Vector}=Matter,engine=Engine.create(),world=engine.world,canvas_width=1700,canvas_height=850,render=Render.create({element:document.body,engine:engine,options:{width:.7*canvas_width,height:canvas_height,wireframes:!1,background:"#ffffff"}});Render.run(render);const runner=Runner.create();Runner.run(runner,engine);const length=200,width=25;engine.gravity.scale=.01;const link1=Bodies.rectangle(400,200,length,width,{frictionAir:0,chamfer:5,render:{fillStyle:"#3498db",strokeStyle:"#2c3e50",lineWidth:4}}),link2=Bodies.rectangle(400,500,length,width,{frictionAir:0,chamfer:5,render:{fillStyle:"#3498db",strokeStyle:"#2c3e50",lineWidth:4}}),constraint1=Constraint.create({pointA:{x:render.options.width/2,y:render.options.height/2},bodyB:link1,pointB:{x:-length/2+width/2,y:0},stiffness:1,length:0,render:{strokeStyle:"#e74c3c",lineWidth:8}}),constraint2=Constraint.create({bodyA:link1,pointA:{x:length/2,y:0},bodyB:link2,pointB:{x:-length/2,y:0},length:0,render:{strokeStyle:"#e74c3c",lineWidth:8}});Composite.add(world,[link1,link2,constraint1,constraint2]);const renderCanvas=render.canvas,stateSpaceCanvas=document.createElement("canvas");stateSpaceCanvas.width=.3*canvas_width,stateSpaceCanvas.height=canvas_height,stateSpaceCanvas.style.position="absolute",stateSpaceCanvas.style.left=`${renderCanvas.offsetLeft+renderCanvas.width}px`,stateSpaceCanvas.style.top=`${renderCanvas.offsetTop}px`,document.body.appendChild(stateSpaceCanvas);const stateSpaceContext=stateSpaceCanvas.getContext("2d"),plotCenter={x:stateSpaceCanvas.width/2,y:stateSpaceCanvas.height/2};stateSpaceContext.strokeStyle="#000",stateSpaceContext.lineWidth=1,stateSpaceContext.beginPath(),stateSpaceContext.moveTo(0,plotCenter.y),stateSpaceContext.lineTo(stateSpaceCanvas.width,plotCenter.y),stateSpaceContext.moveTo(plotCenter.x,0),stateSpaceContext.lineTo(plotCenter.x,stateSpaceCanvas.height),stateSpaceContext.stroke();const stateSpaceTrail=[],linkTrail=[],stateSpaceScalingX=stateSpaceCanvas.width/(2*Math.PI),stateSpaceScalingY=1e3;Events.on(engine,"afterUpdate",(()=>{linkTrail.unshift({position:Vector.clone(link2.position),speed:link2.speed}),Render.startViewTransform(render),render.context.globalAlpha=1;for(let e=0;e<linkTrail.length;e+=1){const t=linkTrail[e].position,n=linkTrail[e].speed,a=250+Math.round(170*(1-Math.min(1,n/10)));render.context.fillStyle=`hsl(${a}, 100%, 55%)`,render.context.beginPath(),render.context.arc(t.x,t.y,5,0,2*Math.PI),render.context.fill()}Render.endViewTransform(render),linkTrail.length>2e3&&linkTrail.pop();const e=-1*((link1.angle+Math.PI/2)%(2*Math.PI)+Math.PI),t=link1.angularVelocity,n=plotCenter.x+e*stateSpaceScalingX,a=plotCenter.y-t*stateSpaceScalingY;stateSpaceTrail.push({x:n,y:a}),stateSpaceTrail.length>500&&stateSpaceTrail.shift(),stateSpaceContext.clearRect(0,0,stateSpaceCanvas.width,stateSpaceCanvas.height),stateSpaceContext.strokeStyle="#000",stateSpaceContext.lineWidth=3,stateSpaceContext.beginPath(),stateSpaceContext.moveTo(0,plotCenter.y),stateSpaceContext.lineTo(stateSpaceCanvas.width,plotCenter.y),stateSpaceContext.moveTo(plotCenter.x,0),stateSpaceContext.lineTo(plotCenter.x,stateSpaceCanvas.height),stateSpaceContext.stroke(),stateSpaceContext.lineWidth=5;for(let e=0;e<stateSpaceTrail.length;e++){const t=stateSpaceTrail[e],n=stateSpaceTrail[e-1],a=e/stateSpaceTrail.length;e>0&&(stateSpaceContext.beginPath(),stateSpaceContext.strokeStyle=`rgba(230, 126, 34, ${a})`,stateSpaceContext.moveTo(n.x,n.y),stateSpaceContext.lineTo(t.x,t.y),stateSpaceContext.stroke())}stateSpaceContext.fillStyle="#f55742";const s=stateSpaceTrail[stateSpaceTrail.length-1];stateSpaceContext.beginPath(),stateSpaceContext.arc(s.x,s.y,6,0,2*Math.PI),stateSpaceContext.fill()}));const mouse=Matter.Mouse.create(render.canvas),mouseConstraint=Matter.MouseConstraint.create(engine,{mouse:mouse,constraint:{stiffness:.2,render:{visible:!1}}});Composite.add(world,mouseConstraint),render.mouse=mouse;